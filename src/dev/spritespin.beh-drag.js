(function($, window, Spin){
  Spin.behaviors.drag = {
    name : "drag",
    mousedown  : function(e){ 
      var $this = $(this), data = $this.data('spritespin'); 
      $(this).data('lastEvent', e);
      data.stopInertia = true;
      Spin.updateInput(e, data);
      data.onDrag = true;
    },
    mousemove  : function(e){ 
      var $this = $(this), data = $this.data('spritespin');
      if (data.onDrag){
        Spin.updateInput(e, data);
        
        var d;
        if (data.orientation == "horizontal"){
          d = data.dX / data.width;
        } else {
          d = data.dY / data.height;
        }
      
        var dFrame = d * data.frames * data.sense;
        var frame = Math.round(data.clickframe + dFrame);
        $this.spritespin("update", frame);  // update to frame
        $this.spritespin("animate", false);  // stop animation
      }
    },
    mouseup    : function(e){ 
      var $this = $(this), data = $this.data('spritespin');
      data.stopInertia = false;
      if (data.inertia) Spin.inertia(data, $(this).data('lastEvent'), e.timeStamp);
      Spin.resetInput(data);
      data.onDrag = false;
    },
    mouseleave : function(e){ 
      var $this = $(this), data = $this.data('spritespin');
      data.stopInertia = false;
      if (data.inertia) Spin.inertia(data, $(this).data('lastEvent'), e.timeStamp);
      Spin.resetInput(data);
      data.onDrag = false;
    }
  }; 
}(jQuery, window, window.SpriteSpin));
